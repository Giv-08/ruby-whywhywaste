var t="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof self?self:global;var a={};var i=function(){var a={},i=Math.PI/180,r=180/Math.PI,h=6378137,s=20037508.342789244;function isFloat(t){return Number(t)===t&&t%1!==0}function SphericalMercator(i){i=i||{};(this||t).size=i.size||256;(this||t).expansion=true===i.antimeridian?2:1;if(!a[(this||t).size]){var r=(this||t).size;var h=a[(this||t).size]={};h.Bc=[];h.Cc=[];h.zc=[];h.Ac=[];for(var s=0;s<30;s++){h.Bc.push(r/360);h.Cc.push(r/(2*Math.PI));h.zc.push(r/2);h.Ac.push(r);r*=2}}(this||t).Bc=a[(this||t).size].Bc;(this||t).Cc=a[(this||t).size].Cc;(this||t).zc=a[(this||t).size].zc;(this||t).Ac=a[(this||t).size].Ac}SphericalMercator.prototype.px=function(a,r){if(isFloat(r)){var h=(this||t).size*Math.pow(2,r);var s=h/2;var e=h/360;var n=h/(2*Math.PI);var o=h;var c=Math.min(Math.max(Math.sin(i*a[1]),-.9999),.9999);var p=s+a[0]*e;var M=s+.5*Math.log((1+c)/(1-c))*-n;p>o*(this||t).expansion&&(p=o*(this||t).expansion);M>o&&(M=o);return[p,M]}s=(this||t).zc[r];c=Math.min(Math.max(Math.sin(i*a[1]),-.9999),.9999);p=Math.round(s+a[0]*(this||t).Bc[r]);M=Math.round(s+.5*Math.log((1+c)/(1-c))*-(this||t).Cc[r]);p>(this||t).Ac[r]*(this||t).expansion&&(p=(this||t).Ac[r]*(this||t).expansion);M>(this||t).Ac[r]&&(M=(this||t).Ac[r]);return[p,M]};SphericalMercator.prototype.ll=function(a,i){if(isFloat(i)){var h=(this||t).size*Math.pow(2,i);var s=h/360;var e=h/(2*Math.PI);var n=h/2;var o=(a[1]-n)/-e;var c=(a[0]-n)/s;var p=r*(2*Math.atan(Math.exp(o))-.5*Math.PI);return[c,p]}o=(a[1]-(this||t).zc[i])/-(this||t).Cc[i];c=(a[0]-(this||t).zc[i])/(this||t).Bc[i];p=r*(2*Math.atan(Math.exp(o))-.5*Math.PI);return[c,p]};SphericalMercator.prototype.bbox=function(a,i,r,h,s){h&&(i=Math.pow(2,r)-1-i);var e=[a*(this||t).size,(+i+1)*(this||t).size];var n=[(+a+1)*(this||t).size,i*(this||t).size];var o=this.ll(e,r).concat(this.ll(n,r));return"900913"===s?this.convert(o,"900913"):o};SphericalMercator.prototype.xyz=function(a,i,r,h){"900913"===h&&(a=this.convert(a,"WGS84"));var s=[a[0],a[1]];var e=[a[2],a[3]];var n=this.px(s,i);var o=this.px(e,i);var c=[Math.floor(n[0]/(this||t).size),Math.floor((o[0]-1)/(this||t).size)];var p=[Math.floor(o[1]/(this||t).size),Math.floor((n[1]-1)/(this||t).size)];var M={minX:Math.min.apply(Math,c)<0?0:Math.min.apply(Math,c),minY:Math.min.apply(Math,p)<0?0:Math.min.apply(Math,p),maxX:Math.max.apply(Math,c),maxY:Math.max.apply(Math,p)};if(r){var l={minY:Math.pow(2,i)-1-M.maxY,maxY:Math.pow(2,i)-1-M.minY};M.minY=l.minY;M.maxY=l.maxY}return M};SphericalMercator.prototype.convert=function(t,a){return"900913"===a?this.forward(t.slice(0,2)).concat(this.forward(t.slice(2,4))):this.inverse(t.slice(0,2)).concat(this.inverse(t.slice(2,4)))};SphericalMercator.prototype.forward=function(t){var a=[h*t[0]*i,h*Math.log(Math.tan(.25*Math.PI+.5*t[1]*i))];a[0]>s&&(a[0]=s);a[0]<-s&&(a[0]=-s);a[1]>s&&(a[1]=s);a[1]<-s&&(a[1]=-s);return a};SphericalMercator.prototype.inverse=function(t){return[t[0]*r/h,(.5*Math.PI-2*Math.atan(Math.exp(-t[1]/h)))*r]};return SphericalMercator}();a=a=i;var r=a;export{r as default};

