var t=Object.defineProperty;var e=Object.defineProperties;var r=Object.getOwnPropertyDescriptors;var n=Object.getOwnPropertySymbols;var s=Object.prototype.hasOwnProperty;var o=Object.prototype.propertyIsEnumerable;var __defNormalProp=(e,r,n)=>r in e?t(e,r,{enumerable:true,configurable:true,writable:true,value:n}):e[r]=n;var __spreadValues=(t,e)=>{for(var r in e||(e={}))s.call(e,r)&&__defNormalProp(t,r,e[r]);if(n)for(var r of n(e))o.call(e,r)&&__defNormalProp(t,r,e[r]);return t};var __spreadProps=(t,n)=>e(t,r(n));var __objRest=(t,e)=>{var r={};for(var i in t)s.call(t,i)&&e.indexOf(i)<0&&(r[i]=t[i]);if(null!=t&&n)for(var i of n(t))e.indexOf(i)<0&&o.call(t,i)&&(r[i]=t[i]);return r};var __accessCheck=(t,e,r)=>{if(!e.has(t))throw TypeError("Cannot "+r)};var __privateGet=(t,e,r)=>{__accessCheck(t,e,"read from private field");return r?r.call(t):e.get(t)};var __privateAdd=(t,e,r)=>{if(e.has(t))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(t):e.set(t,r)};var __privateSet=(t,e,r,n)=>{__accessCheck(t,e,"write to private field");n?n.call(t,r):e.set(t,r);return r};var __privateMethod=(t,e,r)=>{__accessCheck(t,e,"access private method");return r};var __async=(t,e,r)=>new Promise(((n,s)=>{var fulfilled=t=>{try{step(r.next(t))}catch(t){s(t)}};var rejected=t=>{try{step(r.throw(t))}catch(t){s(t)}};var step=t=>t.done?n(t.value):Promise.resolve(t.value).then(fulfilled,rejected);step((r=r.apply(t,e)).next())}));var i="https://api.mapbox.com/autofill/v1";var a="suggest";var c="retrieve";var l=`${i}/${a}`;var u=`${i}/${c}`;var h=class{constructor(t,e){if(isNaN(t)||isNaN(e))throw new Error(`Invalid LngLat object: (${t}, ${e})`);this.lng=+t;this.lat=+e;if(this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90");if(this.lng>180||this.lng<-180)throw new Error("Invalid LngLat longitude value: must be between -180 and 180")}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}static convert(t){if(t instanceof h)return new h(t.lng,t.lat);if(Array.isArray(t)&&2===t.length)return new h(Number(t[0]),Number(t[1]));if(!Array.isArray(t)&&"object"==typeof t&&null!==t&&("lng"in t||"lon"in t)&&"lat"in t)return new h(Number("lng"in t?t.lng:t.lon),Number(t.lat));throw new Error("`LngLatLike` argument must be specified as an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}};var g=class{constructor(t,e){this._sw=h.convert(t);this._ne=h.convert(e)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new h(this.getWest(),this.getNorth())}getSouthEast(){return new h(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toFlatArray(){return[this._sw.lng,this._sw.lat,this._ne.lng,this._ne.lat]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}static convert(t){if(!t)throw new Error("Invalid LngLatBounds convert value: falsy");if(t instanceof g)return new g(t.getSouthWest(),t.getNorthEast());if(Array.isArray(t)&&2===t.length)return new g(h.convert(t[0]),h.convert(t[1]));if(Array.isArray(t)&&4===t.length)return new g(h.convert([t[0],t[1]]),h.convert([t[2],t[3]]));throw new Error("`LngLatBoundsLike` argument must be specified as an array [<LngLatLike>, <LngLatLike>] or an array [<west>, <south>, <east>, <north>]")}};function generateUUID(){const t=Math.random().toString(16)+Date.now().toString(16)+Math.random().toString(16);const e=t.replace(/\./g,"");const r=[e.slice(0,8),e.slice(8,12),"4"+e.slice(12,15)+"-8"+e.slice(15,18),e.slice(18,30)].join("-");return r}var f=class{constructor(t){this.id=null!=t?t:generateUUID()}toString(){return this.id}static convert(t){return new f(t instanceof f?t.id:t.toString())}};var d="Unknown error";var y=class extends Error{constructor(t,e){super(String(t.message||t.error||d));this.name="MapboxError";this.statusCode=e}toString(){return`${this.name} (${this.statusCode}): ${this.message}`}};function handleNonOkRes(t){return __async(this,null,(function*(){if(!t.ok){const e=yield t.json();throw new y(e,t.status)}}))}var v=globalThis.fetch;var p=globalThis.AbortController;function polyfillFetch({fetch:t,AbortController:e},r=false){if(!t)throw new Error("Fetch implementation must include implementations of `fetch`.");if(!v||r){v=t;p=e}}function getFetch(){if(!v)throw new Error("Fetch implementation not found. Please include a fetch polyfill in your application or use `polyfillFetch` from `@mapbox/search-js-core` to fix this issue.");return{fetch:v,AbortController:p}}function queryParams(...t){const e=[];for(const r of t){if(!r)continue;const t=Object.entries(r);for(const[r,n]of t)null!=n&&e.push(`${r}=${encodeURIComponent(String(n))}`)}return e.join("&")}var m,b;var w=class{constructor(t={}){__privateAdd(this,m);const e=t,{accessToken:r}=e,n=__objRest(e,["accessToken"]);this.accessToken=r;this.defaults=__spreadValues(__spreadValues({},w.defaults),n)}suggest(t,e){return __async(this,null,(function*(){if(!t)throw new Error("searchText is required");const{sessionToken:r,signal:n}=e;const s=__spreadProps(__spreadValues(__spreadValues({},this.defaults),e),{sessionToken:r});const o=new URL(`${l}/${encodeURIComponent(t)}`);o.search=__privateMethod(this,m,b).call(this,s);const{fetch:i}=getFetch();const a=yield i(o.toString(),{signal:n});yield handleNonOkRes(a);const c=yield a.json();return __spreadProps(__spreadValues({},c),{suggestions:c.suggestions.map((e=>__spreadProps(__spreadValues({},e),{original_search_text:t}))),url:o.toString()})}))}retrieve(t,e){return __async(this,null,(function*(){if(!t)throw new Error("suggestion is required");if(!this.canRetrieve(t))throw new Error("suggestion cannot be retrieved");const{sessionToken:r,signal:n}=e;const s=f.convert(r);const o=new URL(`${u}/${t.action.id}`);o.search=queryParams({access_token:this.accessToken,session_token:s.id});const{fetch:i}=getFetch();const a=yield i(o.toString(),{signal:n});yield handleNonOkRes(a);const c=yield a.json();c.url=o.toString();return c}))}canRetrieve(t){const e=t.action;return"string"===typeof(null==e?void 0:e.id)}};var k=w;m=new WeakSet;b=function(t){return queryParams({types:"address",access_token:this.accessToken,streets:t.streets,language:t.language,country:t.country,limit:t.limit},t.sessionToken&&{session_token:f.convert(t.sessionToken).id},t.proximity&&{proximity:"string"===typeof t.proximity?t.proximity:h.convert(t.proximity).toArray().join(",")},t.bbox&&{bbox:"string"===typeof t.bbox?t.bbox:g.convert(t.bbox).toFlatArray().join(",")})};k.defaults={language:"en",proximity:"ip",streets:true};var x="https://api.mapbox.com/search/searchbox/v1";var _="suggest";var T="retrieve";var S="category";var L="reverse";var E=`${x}/${_}`;var $=`${x}/${T}`;var j=`${x}/${S}`;var A=`${x}/${L}`;var R,N;var O=class{constructor(t={}){__privateAdd(this,R);const e=t,{accessToken:r}=e,n=__objRest(e,["accessToken"]);this.accessToken=r;this.defaults=__spreadValues(__spreadValues({},O.defaults),n)}suggest(t,e){return __async(this,null,(function*(){if(!t)throw new Error("searchText is required");const{sessionToken:r,signal:n}=e;const s=__spreadProps(__spreadValues(__spreadValues({},this.defaults),e),{q:t,sessionToken:r});if(s.eta_type&&(!s.origin||!s.navigation_profile))throw new Error("to provide eta estimate: eta, navigation_profile, and origin are required");if(s.origin&&!s.navigation_profile)throw new Error("to provide distance estimate: both navigation_profile and origin are required");const o=new URL(E);o.search=__privateMethod(this,R,N).call(this,s);const{fetch:i}=getFetch();const a=yield i(o.toString(),{signal:n});yield handleNonOkRes(a);const c=yield a.json();c.url=o.toString();return c}))}retrieve(t,e){return __async(this,null,(function*(){if(!t)throw new Error("suggestion is required");const{sessionToken:r,signal:n}=e;const s=f.convert(r);const o=new URL(`${$}/${encodeURIComponent(t.mapbox_id)}`);o.search=queryParams({access_token:this.accessToken,session_token:s.id});const{fetch:i}=getFetch();const a=yield i(o.toString(),{signal:n});yield handleNonOkRes(a);const c=yield a.json();c.url=o.toString();return c}))}category(t){return __async(this,arguments,(function*(t,e={}){if(!t)throw new Error("category is required");const r=__spreadValues(__spreadValues({},this.defaults),e);const n=new URL(`${j}/${encodeURIComponent(t)}`);n.search=__privateMethod(this,R,N).call(this,r);const{fetch:s}=getFetch();const o=yield s(n.toString(),{signal:r.signal});yield handleNonOkRes(o);const i=yield o.json();i.url=n.toString();return i}))}reverse(t){return __async(this,arguments,(function*(t,e={}){if(!t)throw new Error("lngLat is required");const[r,n]="string"===typeof t?t.split(",").map((t=>parseFloat(t))):h.convert(t).toArray();if(isNaN(r)||isNaN(n))throw new Error("lngLat is required");const s=__spreadValues(__spreadValues({},this.defaults),e);const o=new URL(A);o.search=queryParams({access_token:this.accessToken,language:s.language,limit:s.limit,longitude:r,latitude:n},s.types&&{types:"string"===typeof s.types?s.types:[...s.types].join(",")});const{fetch:i}=getFetch();const a=yield i(o.toString(),{signal:s.signal});yield handleNonOkRes(a);const c=yield a.json();c.url=o.toString();return c}))}};var q=O;R=new WeakSet;N=function(t){return queryParams({q:t.q,access_token:this.accessToken,language:t.language,limit:t.limit,navigation_profile:t.navigation_profile,route:t.route,route_geometry:t.route_geometry,sar_type:t.sar_type,time_deviation:t.time_deviation,eta_type:t.eta_type,country:t.country,poi_category:t.poi_category,radius:t.radius,user_id:t.user_id,rich_metadata_provider:t.rich_metadata_provider,poi_category_exclusions:t.poi_category_exclusions},t.sessionToken&&{session_token:f.convert(t.sessionToken).id},t.proximity&&{proximity:"string"===typeof t.proximity?t.proximity:h.convert(t.proximity).toArray().join(",")},t.origin&&{origin:"string"===typeof t.origin?t.origin:h.convert(t.origin).toArray().join(",")},t.bbox&&{bbox:"string"===typeof t.bbox?t.bbox:g.convert(t.bbox).toFlatArray().join(",")},t.types&&{types:"string"===typeof t.types?t.types:[...t.types].join(",")})};q.defaults={language:"en"};var F="https://api.mapbox.com/autofill/v1";var U="retrieve";var C=`${F}/${U}`;var P,I;var W=class{constructor(t={}){__privateAdd(this,P);const e=t,{accessToken:r}=e,n=__objRest(e,["accessToken"]);this.accessToken=r;this.defaults=__spreadValues(__spreadValues({},W.defaults),n)}validate(t,e){return __async(this,null,(function*(){if(!t)throw new Error("searchText is required");const{sessionToken:r,signal:n}=e;const s=__spreadProps(__spreadValues(__spreadValues({},this.defaults),e),{sessionToken:r});const o=new URL(`${C}/${encodeURIComponent(t)}`);o.search=__privateMethod(this,P,I).call(this,s);const{fetch:i}=getFetch();const a=yield i(o.toString(),{signal:n});yield handleNonOkRes(a);const c=yield a.json();c.url=o.toString();c.features.length>0&&(c.features=[c.features[0]]);return c}))}};var M=W;P=new WeakSet;I=function(t){return queryParams({access_token:this.accessToken,language:t.language,country:t.country},t.sessionToken&&{session_token:f.convert(t.sessionToken).id},t.proximity&&{proximity:"string"===typeof t.proximity?t.proximity:h.convert(t.proximity).toArray().join(",")},t.bbox&&{bbox:"string"===typeof t.bbox?t.bbox:g.convert(t.bbox).toFlatArray().join(",")})};M.defaults={language:"en",proximity:"ip"};var z="https://api.mapbox.com/geocoding/v5";var D=`${z}/mapbox.places`;var B=`${z}/mapbox.places-permanent`;var G,V;var H=class{constructor(t={}){__privateAdd(this,G);const e=t,{accessToken:r}=e,n=__objRest(e,["accessToken"]);this.accessToken=r;this.defaults=__spreadValues({},n)}forward(t,e){return __async(this,null,(function*(){if(!t)throw new Error("searchText is required");let r;e&&({signal:r}=e);const n=__spreadValues(__spreadValues({},this.defaults),e);const s=n.permanent?B:D;const o=new URL(`${s}/${encodeURIComponent(t)}.json`);o.search=__privateMethod(this,G,V).call(this,n);const{fetch:i}=getFetch();const a=r?{signal:r}:{};const c=yield i(o.toString(),a);yield handleNonOkRes(c);const l=yield c.json();l.url=o.toString();return l}))}reverse(t,e){return __async(this,null,(function*(){if(!t)throw new Error("lngLat is required");let r;e&&({signal:r}=e);const n=__spreadValues(__spreadValues({},this.defaults),e);const s="string"===typeof t?t:h.convert(t).toArray().join(",");const o=n.permanent?B:D;const i=new URL(`${o}/${encodeURIComponent(s)}.json`);i.search=__privateMethod(this,G,V).call(this,n,true);const{fetch:a}=getFetch();const c=r?{signal:r}:{};const l=yield a(i.toString(),c);yield handleNonOkRes(l);const u=yield l.json();u.url=i.toString();return u}))}};G=new WeakSet;V=function(t,e=false){e&&["proximity","autocomplete","fuzzyMatch","bbox"].forEach((e=>{e in t&&delete t[e]}));return queryParams({access_token:this.accessToken,language:t.language,country:t.country,limit:t.limit,autocomplete:t.autocomplete,fuzzyMatch:t.fuzzyMatch,routing:t.routing,worldview:t.worldview},t.proximity&&{proximity:"string"===typeof t.proximity?t.proximity:h.convert(t.proximity).toArray().join(",")},t.bbox&&{bbox:"string"===typeof t.bbox?t.bbox:g.convert(t.bbox).toFlatArray().join(",")},t.types&&{types:"string"===typeof t.types?t.types:[...t.types].join(",")})};var J=(t=>{t.exact="exact";t.high="high";t.medium="medium";t.low="low";return t})(J||{});var K;var Q=class{constructor(){__privateAdd(this,K,{})}addEventListener(t,e){const r=__privateGet(this,K);r[t]||(r[t]=[]);r[t].push(e)}removeEventListener(t,e){const r=__privateGet(this,K);if(!r[t])return;const n=r[t];const s=n.indexOf(e);-1!==s&&n.splice(s,1)}fire(t,e){const r=__privateGet(this,K);if(!r[t])return;const n=r[t];for(const t of n)t(e)}};K=new WeakMap;function debounce(t,e,r){let n=null;return(...s)=>{null!==n&&clearTimeout(n);const o=r&&r();n=setTimeout((()=>{n=null;(null==o?void 0:o.aborted)||t(...s)}),e)}}function createAbortController(){const{AbortController:t}=getFetch();return new t}var X,Y,Z;var tt=class extends Q{constructor(t,e=0){super();this.sessionToken=new f;__privateAdd(this,X,void 0);__privateAdd(this,Y,createAbortController());__privateAdd(this,Z,void 0);__privateSet(this,Z,debounce(((t,...e)=>__async(this,[t,...e],(function*(t,e={}){__privateGet(this,Y).abort();__privateSet(this,Y,createAbortController());if(t)try{const r=yield this.search.suggest(t,__spreadProps(__spreadValues({sessionToken:this.sessionToken},e),{signal:__privateGet(this,Y).signal}));__privateSet(this,X,r);this.fire("suggest",r)}catch(t){if("AbortError"===t.name)return;this.fire("suggesterror",t)}else{__privateSet(this,X,null);this.fire("suggest",__privateGet(this,X))}}))),e,(()=>__privateGet(this,Y).signal)));Object.defineProperties(this,{search:{value:t,writable:false},debounce:{value:e,writable:false}})}get suggestions(){return __privateGet(this,X)}suggest(t,e){__privateGet(this,Z).call(this,t,e);return new Promise(((t,e)=>{let r;let n;r=e=>{this.removeEventListener("suggest",r);this.removeEventListener("suggesterror",n);t(e)};n=t=>{this.removeEventListener("suggest",r);this.removeEventListener("suggesterror",n);e(t)};this.addEventListener("suggest",r);this.addEventListener("suggesterror",n)}))}clear(){this.suggest("")}retrieve(t,e){return __async(this,null,(function*(){const r=yield this.search.retrieve(t,__spreadValues({sessionToken:this.sessionToken},e));this.fire("retrieve",r);return r}))}canRetrieve(t){return!this.search.canRetrieve||this.search.canRetrieve(t)}canSuggest(t){return!this.search.canSuggest||this.search.canSuggest(t)}abort(){__privateGet(this,Y).abort();__privateSet(this,Y,createAbortController())}};X=new WeakMap;Y=new WeakMap;Z=new WeakMap;function featureToSuggestion(t){const{properties:e}=t;return __spreadValues({},e)}export{k as AddressAutofillCore,Q as Evented,H as GeocodingCore,h as LngLat,g as LngLatBounds,k as MapboxAutofill,y as MapboxError,H as MapboxGeocode,M as MapboxValidate,J as MatchCodeConfidence,q as SearchBoxCore,tt as SearchSession,f as SessionToken,M as ValidationCore,debounce,featureToSuggestion,polyfillFetch};

